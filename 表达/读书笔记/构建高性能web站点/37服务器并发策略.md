# 服务器并发策略
> 从本质上讲，所有到达服务器的请求都封装在IP包中，位于网卡的接收缓冲区中，这时候。。。

问题1：网卡的接收缓冲区是属于网卡的一部分吗?

## 一个进程处理一个连接，非阻塞I/O
fork模式 由主进程负责accept()来自客户端的连接，一旦接收连接，便马上fork（）一个新的worker进程来处理，处理结束后，这个进程便被销毁。
prefork模式 主进程预先创建一定数量的子进程，每个请求由一个子进程来处理，但每个子进程可以处理多个请求。父进程只负责管理子进程，根据站点负载来调整子进程的数量，相当于动态维护一个进程池。

accept()是在一个socket接收的一个连接，accept（）是c语言中网络编程的重要的函数。有以下两种策略：
* 主进程用非阻塞accept()来接收连接，当建立连接后，主进程将任务分配给空闲的子进程来处理；
* 所有子进程使用阻塞accept()来竞争接收连接，一旦一个子进程建立连接后，它将继续进行处理。

poll()用来检查当前的socket连接是否有新的请求数据到达。

## 一个线程处理一个连接，非阻塞I/O
允许在一个进程中通过多个线程来处理多个连接，其中每个线程处理一个连接。

## 一个进程处理多个连接，非阻塞I/O
一个进程处理多个连接，存在一个潜在条件，就是多路I/O就绪通知的应用，上一章讲过多路I/O就绪通知的方法，例如select、poll、epoll等。这种并发策略下，多路I/O就绪通知的性能成为关键。

worker进程：处理多个连接的进程，
在web服务器中，worker进程数可以配置，配置worker进程数越多，每个连接下载速度越慢，如何配置需要根据具体业务来衡量。

常见的几种就绪通知方法中，select方法的最大限制1024个连接，多于上限值则无法提供服务，epoll的优势在有大量非活跃连接时，不会浪费时间去扫描非活跃连接，从而提高性能，例如采用前后端采用长连接方式时，相较于poll和select有很大优势。

## 一个线程处理多个连接，异步I/O
即便是拥有高性能的多路I/O就绪通知方法，但是磁盘I/O操作的等待还是无法完全避免，例如读取磁盘的数据，更高效的方法是对磁盘文件操作使用异步I/O。
问题：目前已经有支持异步I/O策略的web服务器了吗？


### 常用命令
strace：常用来跟踪进程执行时的系统调用和所接收的信号。 
在Linux世界，进程不能直接访问硬件设备，当进程需要访问硬件设备(比如读取磁盘文件，接收网络数据等等)时，必须由用户态模式切换至内核态模式，通过系统调用访问硬件设备。strace可以跟踪到一个进程产生的系统调用,包括参数，返回值，执行消耗的时间。